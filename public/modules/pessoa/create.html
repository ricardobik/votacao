<!DOCTYPE html>
<html>

<head>
	<!--Import Google Icon Font-->
	<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<!--Import qunit.css-->
	<link type="text/css" rel="stylesheet" href="https://code.jquery.com/qunit/qunit-git.css" media="screen,projection" />
	<!--Import materialize.css-->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/css/materialize.min.css">

	<!--Import SweetAlert with google style-->
	<link type="text/css" rel="stylesheet" href="/sass/sweetalert.css" media="screen,projection" />
	<link type="text/css" rel="stylesheet" href="/sass/themes/google/google.css" media="screen,projection" />
	<link type="text/css" rel="stylesheet" href="/sass/style.css" media="screen,projection" />
	<link type="text/css" rel="stylesheet" href="/sass/croppie.css" media="screen,projection" />

	<!--Let browser know website is optimized for mobile-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>

	<!-- Import Navbar -->
	<div id="nav-bar"></div>

	<div class="container">
		<div class="row">
			<form role="form" method="POST" id="pessoa_form" v-on="submit: cropPicture">

				<!-- card structure -->
				<input type="hidden" name="foto" id="foto">
				<div class="col s12 m8 offset-m2">
					<div class="card horizontal">
						<div class="card-image">
							<img src="" id="preview">
							<a href="#modalfoto" class="btn-floating btn-large waves-effect waves-light modal-trigger upload-btn">
								<i class="material-icons">backup</i>
							</a>
						</div>
						<div class="card-stacked">
							<div class="card-content">
								<span class="card-title">Cadastrar</span>

								<!--Checkboxes-->
								<div class="row check-row">
									<div class="col m4">
										<input name="candidato" type="checkbox" id="candidato" />
										<label for="candidato">Candidato</label>
									</div>
									<div class="col m3">
										<input name="eleitor" type="checkbox" id="eleitor" />
										<label for="eleitor">Eleitor</label>
									</div>
									<div class="col m4">
										<input name="responsavel" type="checkbox" id="responsavel" />
										<label for="responsavel">Responsável</label>
									</div>
								</div>

								<div class="row">
									<div class="input-field col m12 s12">
										<input id="nome" name="nome" type="text" class="validate" required="" aria-required="true">
										<label class="active" for="nome">Nome Completo</label>
									</div>
									<div class="input-field col m6 s12">
										<input id="cpf" name="cpf" type="text" class="validate" required="" aria-required="true">
										<label for="cpf">Cpf</label>
									</div>
								</div>

								<!--Se pessoa for usuário-->
								<div class="row hide" id="mostrarpassword">
									<div class="input-field col m6 s12">
										<label for="Senha">Senha</label>
									</div>
									<div class="input-field col m6 s12">
										<label for="Confirme sua senha">Confirme sua senha</label>
									</div>
								</div>

							</div>
							<div class="card-action">
								<div class="card-action right-align">
									<a class="waves-effect waves-light btn" id="submit" name="submit"><i class="material-icons right">send</i>Enviar</a>
								</div>
							</div>
							<!--action button-->
							<div class="fixed-action-btn horizontal">
								<a class="btn-floating btn-large red">
									<i class="large material-icons">add</i>
								</a>
								<ul>
									<li><a href="javascripti:void(0)" onclick="javascript:goSearch(); return false;" class="btn-floating purple"><i class="material-icons">search</i></a></li>
									<li><a href="javascripti:void(0)" onclick="javascript:goHome(); return false;" id="home" class="btn-floating green"><i class="material-icons">home</i></a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>

	<!-- Modal Structure -->
	<!--	<div id="modalfoto" class="modal modalfoto">-->
	<div id="modalfoto" class="modal">
		<div class="modal-content">

			<div id="upload-img" class="croppie-container"></div>
			<div class="upload-msg"></div>

			<div class="file-field input-field">
				<div class="btn">
					<span>Foto</span>
					<input type="file" id="upload">
				</div>
				<div class="file-path-wrapper">
					<input class="file-path validate" type="text">
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat" id="trocar">Pronto</a>
		</div>
	</div>


	<!--Import jQuery before materialize.js-->
	<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
	<!--    <script type="text/javascript" src="/js/bin/materialize.min.js"></script>-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/js/materialize.min.js"></script>

	<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.15.0/jquery.validate.min.js"></script>
	<script type="text/javascript" src="/js/bin/sweetalert.min.js"></script>
	<script type="text/javascript" src="/js/Croppie/croppie.min.js"></script>

	<!--Import JUnit tests-->
	<script type="text/javascript" src="https://code.jquery.com/qunit/qunit-2.1.1.js"></script>

	<script type="text/javascript" src="/js/components/general.js"></script>
	<script type="text/javascript" src="/js/components/pessoa.js"></script>

	<script>
		$(document).ready(function() {

			//Load Navbar and dropdown menu
			$('#nav-bar').load("/modules/layout/navbar.html", function() {
				$(".button-collapse").sideNav();
				$('.dropdown-button').dropdown();
				$("#brasao").attr("src", imageUrl + "brasao_branco.png");
				$("#preview").attr("src", imageUrl + "avatar.png");
			});

			$('.modal').modal({
				dismissible: false

			});

			//get de form data and save
			$("#submit").click(function(e) {
				var data = new Object();
				data.nome = $("#nome").val();
				data.cpf = $('#cpf').val()
				data.foto = $("#foto").val();
				data.candidato = $('#candidato').prop('checked');
				data.eleitor = $('#eleitor').prop('checked');
				data.responsavel = $('#responsavel').prop('checked');
				createPessoa(data);
				//				console.log(data);
			});

			$uploadCrop = $('#upload-demo').croppie({
				enableExif: true,
				viewport: {
					width: 200,
					height: 200,
					type: 'circle'
				},
				boundary: {
					width: 300,
					height: 310
				}
			});

			function readFile(input) {
				if (input.files && input.files[0]) {
					var reader = new FileReader();

					reader.onload = function(e) {
						$uploadCrop.croppie('bind', {
							url: e.target.result
						});
						$('.upload-img').addClass('ready');
						$("#preview").addClass('img-preview');
					}

					reader.readAsDataURL(input.files[0]);
				} else {
					swal("Sorry - you're browser doesn't support the FileReader API");
				}
			};

			$('#upload').on('change', function() {
				readFile(this);
			});

			var $uploadCrop = $('#upload-img').croppie({
				exif: true,
				viewport: {
					width: 200,
					height: 200
				},
				boundary: {
					width: 300,
					height: 300
				},
				showZoomer: false,
				update: function() {
					this.result('canvas').then(function(base) {
						$("#foto").val(base);
						$("#preview").attr('src', base);
					});
				}
			});

		});

	</script>

</body>

</html>
